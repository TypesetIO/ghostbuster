After hours of tense negotiations, a historic compromise was reached.